---
- name: initialize cluster
  command: ha-cluster-init -y csync2
  args:
    creates: /etc/csync2/key_hagroup
  when: is_primary

- name: write cluster configuration
  template:
    src: etc/corosync/corosync.conf.j2
    dest: /etc/corosync/corosync.conf
    mode: 0644
    owner: root
    group: root
  when: is_primary

- name: start and enable services
  service:
    name: '{{ item }}'
    state: started
    enabled: true
  loop:
  - corosync.service
  - pacemaker.service
  when: is_primary
